Описание формата BLOB для таблиц / вью / мап


Таблица (Байт, описание)
0x10, 
0x00, 
0xXX - байт, (число строчек с оканчивающимся 0) + 1, которые идут далее (а после них блок настроек №1). т.е. если тут стоит 0xA значит ниже будет 9 строк, а затем настройки.
строка Label					с оканчивающимся 0
строка FormRef					с оканчивающимся 0
строка ReportRef				с оканчивающимся 0
строка SingularLabel			с оканчивающимся 0 
строка SearchLinkRefName		с оканчивающимся 0
строка Query					с оканчивающимся 0 
строка DeveloperDocumentation	с оканчивающимся 0
строка CountryRegionCodes		с оканчивающимся 0
строка ListPageRef				с оканчивающимся 0
строка PreviewPartRef			с оканчивающимся 0 (если какая либо из этих строк в таблице в аксапте не заполнена, то тут может просто стоять либо 0x0000 либо ничего, т.е. строка может быть пропущена. Как определить пропущена она или нет - нужно смотреть соответсвующий бит в настройках блок 1. Добраться до блока можно взяв 3-й байт от начала, вычесть 1 и отсчитать полученное число строк по терминирующим нулям 0x0000)

Блок настроек №1. Упакованные свойства 4 байта.  Набор битов, которыё обозначают заполненность свойств таблички. 0 - свойство не заполнено или имеет дефолтное значение. 1 - свойство имеет недефолтное значение. Реальное значение будет храниться в блоке настроек №2. Описание битов
Байт 1
0000 0001  ???
0000 0010  Есть дочерние DeleteActions - если есть то ниже добавляются 2 байта (кодируют int16 число DeleteAction-ов) к смещению внутри блока ( - до visible И Cache) - но только если не задан TitleField1 и TitleField2. - Если они заданы, то эти 2 байта идут перед ними до блока с настройками.
0000 0100  TitleField1 заполнено - добавляет смещение следующего блока на 1 строку
0000 1000  TitleField2 заполнено - добавляет смещение следующего блока на 1 строку
0001 0000  Visible = Yes или MaxAccessMode =#NoAccess (во второй группе создается доп значение. Для MaxAccessMode 0x04)  - добавляет 1 байт к смещению внутри блока #2
0010 0000  CacheLookup непустой  - добавляет 1 байт к смещению внутри блока #2
0100 0000  ???
1000 0000  ???

Байт 2
0000 0001 TableGroup - значение задано
0000 0010 
0000 0100  PrimaryIndex - значение задано
0000 1000  ClusterIndex - значение задано
0001 0000  TableContents - значение задано
0010 0000  ConfigurationKey значение задано
0100 0000  CreateRecIdIndex - Yes
1000 0000  SecurityKey значение задано

Байт 3
0000 0100 OccEnabled = No (недефолтное значение)
0001 0000 AnalysisIdentifier = недефолтное значение
1000 0000 AnalysisDimensionType - недефолтное значение

Байт 4
0000 0001 - EntityRelationshipType - Relationship (0 - для Entity)
0000 0010 - ???
0000 0100 - ReplacementKey - непустое значение
0000 1000 - Extends непустое значение - добавляет смещение следующего блока на 1 строку
0001 0000 - EnforceFKRelation
0010 0000 - Abstract
0100 0000 - InstanceRelationType - непустое
1000 0000 - SupportInheritance

Далее идут значения свойств

строка Extends					с оканчивающимся 0 (только для таблиц c наследованием и если взведен бит в блоке настроек 1 в 4-м байте)
2 байта - число дочерних DeleteActions. Но только если взведен бит в болке настроек 1 в байте 1. Иначе 2 байта пропускаются (т.е. не ставится 0x0000, а просто ничего нет)
строка TitleField1				с оканчивающимся 0 (если взведен бит в блоке настроек 1 в 1-м байте)
строка TitleField2				с оканчивающимся 0 (если взведен бит в блоке настроек 1 в 1-м байте)

Упакованные свойства Блок настроек № 2 (тут хранятся сами значения, записанные подряд. Если соответсвующий бтик из болка настроек №1 не взведен, то значения просто пропущено, что представляет некоторую сложность при распаковке)
Байт для свойства Visible (оно же MaxAccessMode в выгрузке xpo) - только если взведен битик в блок №1 в 1-м байте
Байт для свойства CacheLookup - только если взведен битик в блок №1 в 1-м байте
БАЙТ ДЛЯ ТИПА ТАБЛИЦЫ (ради него все и расковыряли. 0x80 - Regular table, 0x40 - TempDb table, 0x02 -- InMemory table, 0x04 - View, 0x01 - Map

Все что ниже - описано примерно (но можно точнее восстановить во Excel файлу) - детали уже подзабыл и по памяти восстановить сложно и затратно по времени. Да и не очень нужно.

3-5 байт с другими настройками
1-й байт 
0000 0010 DEL_ModifiedTime
0000 0100 ModifiedBy
0000 1000 ModifiedTranscationId
0001 0000 CreatedDateTime
0010 0000 DEL_CreatedTime
0100 0000 CreatedBy
1000 0000 CreatedTranscationId

2-й байт
0000 0001 - SupportInheritance ??
3-й байт - свойство TableGroup

строка PrimaryIndex			с оканчивающимся 0
строка ClusterIndex			с оканчивающимся 0

Упакованные свойства

строка ConfigurationKey		с оканчивающимся 0 (если ConfigurationKey пусто, то оканчивающихся 0 нет и не взведен бит в блоке №1 во 2-м байте)

Упакованные свойства (316-317)
1-й байт свойств 
0000 0100 - SystemTable = Yes
0000 0100 - Systemtable = Yes (bit 04)
0000 0010 - CreateRecIdIndex = Yes (bit 02)
0000 0001 - SaveDataPerCompany = Yes (bit 01 inverted)
1000 0000 - SaveDataPerPartition =  Yes (bit 08 inverted)

2-й байт свойств
0000 0001 - IsLookup = No

Свойство строка AnalysisIdentifier		с оканчивающимся 0

Упакованные свойства (351-355)

Свойство строка ReplacementKeyIdx		с оканчивающимся 0
Свойство строка InstanceRelationType	с оканчивающимся 0 (для таблиц с наследованием - и возможно раньше предыдущей строки с ReplacementKeyIdx - это надо проверить)

Упакованные свойства (399-403)
Упакованное свойство (404)  	(только Table) Значения 01 - ValidTimeStateFieldType = Date, 02 - ValidTimeStateFieldType = UtcDateTime
Упакованные свойства (405-440)  (только Table) - всегда строки ValidFrom ValidTo если взведено свойство ValidTimeStateFieldType

Свойство строка CountryRegionCodes		с оканчивающимся 0 
Свойство строка CountryRegionContextField	с оканчивающимся 0





